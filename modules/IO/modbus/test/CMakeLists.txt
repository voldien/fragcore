
FIND_PACKAGE(GTest REQUIRED)
IF(GTEST_FOUND)
	MESSAGE(STATUS "Gtest found: ${GTEST_BOTH_LIBRARIES}")
ELSE()
	MESSAGE(ERROR "Gtest is required in order to compile and run the tests")
ENDIF()

# Source files.
FILE(GLOB MODBUSTEST_SOURCE_FILES ${CMAKE_CURRENT_SOURCE_DIR}/*.cpp )
FILE(GLOB MODBUSTEST_HEADER_FILES ${CMAKE_CURRENT_SOURCE_DIR}/*.h)

ADD_EXECUTABLE(modbus-io-test ${MODBUSTEST_SOURCE_FILES} ${MODBUSTEST_HEADER_FILES})
TARGET_LINK_LIBRARIES(modbus-io-test GTest::GTest GTest::Main fragcore-ionet-modbus )
TARGET_INCLUDE_DIRECTORIES(modbus-io-test PRIVATE ${GTEST_INCLUDE_DIRS} ${CMAKE_CURRENT_SOURCE_DIR}/)
ADD_DEPENDENCIES(modbus-io-test fragcore-ionet-modbus)

ADD_TEST(NAME modbus-io-test
		COMMAND modbus-io-test
		WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})
